{"version":3,"sources":["../../../../../lib/xlsx/xform/drawing/drawing-xform.js"],"names":["utils","require","colCache","XmlStream","BaseXform","TwoCellAnchorXform","OneCellAnchorXform","WorkSheetXform","module","exports","map","getAnchorType","model","range","decode","br","inherits","DRAWING_ATTRIBUTES","tag","prepare","anchors","forEach","item","index","anchorType","anchor","render","xmlStream","openXml","StdDocAttributes","openNode","closeNode","parseOpen","node","parser","name","reset","parseText","text","parseClose","push","undefined","reconcile","options"],"mappings":"AAAA;;AAEA,IAAMA,KAAK,GAAGC,OAAO,CAAC,sBAAD,CAArB;;AACA,IAAMC,QAAQ,GAAGD,OAAO,CAAC,0BAAD,CAAxB;;AACA,IAAME,SAAS,GAAGF,OAAO,CAAC,2BAAD,CAAzB;;AAEA,IAAMG,SAAS,GAAGH,OAAO,CAAC,eAAD,CAAzB;;AACA,IAAMI,kBAAkB,GAAGJ,OAAO,CAAC,yBAAD,CAAlC;;AACA,IAAMK,kBAAkB,GAAGL,OAAO,CAAC,yBAAD,CAAlC;;AAEA,IAAMM,cAAc,GAAIC,MAAM,CAACC,OAAP,GAAiB,YAAW;AAClD,OAAKC,GAAL,GAAW;AACT,yBAAqB,IAAIL,kBAAJ,EADZ;AAET,yBAAqB,IAAIC,kBAAJ;AAFZ,GAAX;AAID,CALD;;AAOA,SAASK,aAAT,CAAuBC,KAAvB,EAA8B;AAC5B,MAAMC,KAAK,GAAG,OAAOD,KAAK,CAACC,KAAb,KAAuB,QAAvB,GAAkCX,QAAQ,CAACY,MAAT,CAAgBF,KAAK,CAACC,KAAtB,CAAlC,GAAiED,KAAK,CAACC,KAArF;AAEA,SAAOA,KAAK,CAACE,EAAN,GAAW,mBAAX,GAAiC,mBAAxC;AACD;;AAEDf,KAAK,CAACgB,QAAN,CACET,cADF,EAEEH,SAFF,EAGE;AACEa,EAAAA,kBAAkB,EAAE;AAClB,iBAAa,qEADK;AAElB,eAAW;AAFO;AADtB,CAHF,EASE;AACE,MAAIC,GAAJ,GAAU;AACR,WAAO,UAAP;AACD,GAHH;;AAKEC,EAAAA,OALF,mBAKUP,KALV,EAKiB;AAAA;;AACbA,IAAAA,KAAK,CAACQ,OAAN,CAAcC,OAAd,CAAsB,UAACC,IAAD,EAAOC,KAAP,EAAiB;AACrCD,MAAAA,IAAI,CAACE,UAAL,GAAkBb,aAAa,CAACW,IAAD,CAA/B;AACA,UAAMG,MAAM,GAAG,KAAI,CAACf,GAAL,CAASY,IAAI,CAACE,UAAd,CAAf;AACAC,MAAAA,MAAM,CAACN,OAAP,CAAeG,IAAf,EAAqB;AAAEC,QAAAA,KAAK,EAALA;AAAF,OAArB;AACD,KAJD;AAKD,GAXH;AAaEG,EAAAA,MAbF,kBAaSC,SAbT,EAaoBf,KAbpB,EAa2B;AAAA;;AACvBe,IAAAA,SAAS,CAACC,OAAV,CAAkBzB,SAAS,CAAC0B,gBAA5B;AACAF,IAAAA,SAAS,CAACG,QAAV,CAAmB,KAAKZ,GAAxB,EAA6BX,cAAc,CAACU,kBAA5C;AAEAL,IAAAA,KAAK,CAACQ,OAAN,CAAcC,OAAd,CAAsB,UAAAC,IAAI,EAAI;AAC5B,UAAMG,MAAM,GAAG,MAAI,CAACf,GAAL,CAASY,IAAI,CAACE,UAAd,CAAf;AACAC,MAAAA,MAAM,CAACC,MAAP,CAAcC,SAAd,EAAyBL,IAAzB;AACD,KAHD;AAKAK,IAAAA,SAAS,CAACI,SAAV;AACD,GAvBH;AAyBEC,EAAAA,SAzBF,qBAyBYC,IAzBZ,EAyBkB;AACd,QAAI,KAAKC,MAAT,EAAiB;AACf,WAAKA,MAAL,CAAYF,SAAZ,CAAsBC,IAAtB;AACA,aAAO,IAAP;AACD;;AACD,YAAQA,IAAI,CAACE,IAAb;AACE,WAAK,KAAKjB,GAAV;AACE,aAAKkB,KAAL;AACA,aAAKxB,KAAL,GAAa;AACXQ,UAAAA,OAAO,EAAE;AADE,SAAb;AAGA;;AACF;AACE,aAAKc,MAAL,GAAc,KAAKxB,GAAL,CAASuB,IAAI,CAACE,IAAd,CAAd;;AACA,YAAI,KAAKD,MAAT,EAAiB;AACf,eAAKA,MAAL,CAAYF,SAAZ,CAAsBC,IAAtB;AACD;;AACD;AAZJ;;AAcA,WAAO,IAAP;AACD,GA7CH;AA+CEI,EAAAA,SA/CF,qBA+CYC,IA/CZ,EA+CkB;AACd,QAAI,KAAKJ,MAAT,EAAiB;AACf,WAAKA,MAAL,CAAYG,SAAZ,CAAsBC,IAAtB;AACD;AACF,GAnDH;AAqDEC,EAAAA,UArDF,sBAqDaJ,IArDb,EAqDmB;AACf,QAAI,KAAKD,MAAT,EAAiB;AACf,UAAI,CAAC,KAAKA,MAAL,CAAYK,UAAZ,CAAuBJ,IAAvB,CAAL,EAAmC;AACjC,aAAKvB,KAAL,CAAWQ,OAAX,CAAmBoB,IAAnB,CAAwB,KAAKN,MAAL,CAAYtB,KAApC;AACA,aAAKsB,MAAL,GAAcO,SAAd;AACD;;AACD,aAAO,IAAP;AACD;;AACD,YAAQN,IAAR;AACE,WAAK,KAAKjB,GAAV;AACE,eAAO,KAAP;;AACF;AACE;AACA,eAAO,IAAP;AALJ;AAOD,GApEH;AAsEEwB,EAAAA,SAtEF,qBAsEY9B,KAtEZ,EAsEmB+B,OAtEnB,EAsE4B;AAAA;;AACxB/B,IAAAA,KAAK,CAACQ,OAAN,CAAcC,OAAd,CAAsB,UAAAI,MAAM,EAAI;AAC9B,UAAIA,MAAM,CAACV,EAAX,EAAe;AACb,QAAA,MAAI,CAACL,GAAL,CAAS,mBAAT,EAA8BgC,SAA9B,CAAwCjB,MAAxC,EAAgDkB,OAAhD;AACD,OAFD,MAEO;AACL,QAAA,MAAI,CAACjC,GAAL,CAAS,mBAAT,EAA8BgC,SAA9B,CAAwCjB,MAAxC,EAAgDkB,OAAhD;AACD;AACF,KAND;AAOD;AA9EH,CATF","sourcesContent":["'use strict';\n\nconst utils = require('../../../utils/utils');\nconst colCache = require('../../../utils/col-cache');\nconst XmlStream = require('../../../utils/xml-stream');\n\nconst BaseXform = require('../base-xform');\nconst TwoCellAnchorXform = require('./two-cell-anchor-xform');\nconst OneCellAnchorXform = require('./one-cell-anchor-xform');\n\nconst WorkSheetXform = (module.exports = function() {\n  this.map = {\n    'xdr:twoCellAnchor': new TwoCellAnchorXform(),\n    'xdr:oneCellAnchor': new OneCellAnchorXform(),\n  };\n});\n\nfunction getAnchorType(model) {\n  const range = typeof model.range === 'string' ? colCache.decode(model.range) : model.range;\n\n  return range.br ? 'xdr:twoCellAnchor' : 'xdr:oneCellAnchor';\n}\n\nutils.inherits(\n  WorkSheetXform,\n  BaseXform,\n  {\n    DRAWING_ATTRIBUTES: {\n      'xmlns:xdr': 'http://schemas.openxmlformats.org/drawingml/2006/spreadsheetDrawing',\n      'xmlns:a': 'http://schemas.openxmlformats.org/drawingml/2006/main',\n    },\n  },\n  {\n    get tag() {\n      return 'xdr:wsDr';\n    },\n\n    prepare(model) {\n      model.anchors.forEach((item, index) => {\n        item.anchorType = getAnchorType(item);\n        const anchor = this.map[item.anchorType];\n        anchor.prepare(item, { index });\n      });\n    },\n\n    render(xmlStream, model) {\n      xmlStream.openXml(XmlStream.StdDocAttributes);\n      xmlStream.openNode(this.tag, WorkSheetXform.DRAWING_ATTRIBUTES);\n\n      model.anchors.forEach(item => {\n        const anchor = this.map[item.anchorType];\n        anchor.render(xmlStream, item);\n      });\n\n      xmlStream.closeNode();\n    },\n\n    parseOpen(node) {\n      if (this.parser) {\n        this.parser.parseOpen(node);\n        return true;\n      }\n      switch (node.name) {\n        case this.tag:\n          this.reset();\n          this.model = {\n            anchors: [],\n          };\n          break;\n        default:\n          this.parser = this.map[node.name];\n          if (this.parser) {\n            this.parser.parseOpen(node);\n          }\n          break;\n      }\n      return true;\n    },\n\n    parseText(text) {\n      if (this.parser) {\n        this.parser.parseText(text);\n      }\n    },\n\n    parseClose(name) {\n      if (this.parser) {\n        if (!this.parser.parseClose(name)) {\n          this.model.anchors.push(this.parser.model);\n          this.parser = undefined;\n        }\n        return true;\n      }\n      switch (name) {\n        case this.tag:\n          return false;\n        default:\n          // could be some unrecognised tags\n          return true;\n      }\n    },\n\n    reconcile(model, options) {\n      model.anchors.forEach(anchor => {\n        if (anchor.br) {\n          this.map['xdr:twoCellAnchor'].reconcile(anchor, options);\n        } else {\n          this.map['xdr:oneCellAnchor'].reconcile(anchor, options);\n        }\n      });\n    },\n  }\n);\n"],"file":"drawing-xform.js"}